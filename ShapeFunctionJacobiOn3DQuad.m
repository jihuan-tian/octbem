function jacobi_matrix = ShapeFunctionJacobiOn3DQuad(order)
  ## ShapeFunctionJacobiOn3DQuad - Generate the Jacobian matrix
  ## for shape functions constructed on the reference quadrangle
  ## depending on the two area coordinate components \f$[\xi
  ## ,\eta]\f$. Let the area coordinates be represented as \f$[\xi,
  ## \eta]\f$. The Jacobian matrix has the following form:
  ## \f$\f$
  ## \begin{matrix}
  ##   \frac{\pdiff N_1}{\xi} & \frac{\pdiff N_1}{\eta} \\
  ##   \frac{\pdiff N_2}{\xi} & \frac{\pdiff N_2}{\eta} \\
  ##                   \cdots &                  \cdots \\
  ##   \frac{\pdiff N_n}{\xi} & \frac{\pdiff N_n}{\eta}
  ## \end{matrix},
  ## \f$\f$
  ## where \f$n\f$ is the number of DOFs or shape functions in the
  ## quadrangle cell. It can be calculated from the shape function order
  ## $p$ as
  ## \f$\f$
  ## n = (p + 1)^2.
  ## \f$\f$
  ## @param order The basis function order.
  ## @param jacobi_matrix The Jacobi matrix for shape functions with respect to
  ## area coordinates.
  
  switch(order)
    case 1
      jacobi_matrix = @(chi) [chi(:,2)-1,chi(:,1)-1;
			      -chi(:,2),1-chi(:,1);
			      1-chi(:,2),-chi(:,1);
			      chi(:,2),chi(:,1)];
    case 2
      jacobi_matrix = @(chi) [4.*(chi(:,2)-1).*(chi(:,2)-1/2).*(chi(:,1)-1/2)+4.*(chi(:,2)-1).*(chi(:,2)-1/2).*(chi(:,1)-1), 4.*(chi(:,2)-1/2).*(chi(:,1)-1).*(chi(:,1)-1/2)+4.*(chi(:,2)-1).*(chi(:,1)-1).*(chi(:,1)-1/2);
			     (-8.*(chi(:,2)-1).*chi(:,2).*(chi(:,1)-1/2))-8.*(chi(:,2)-1).*chi(:,2).*(chi(:,1)-1), (-8.*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-1/2))-8.*(chi(:,2)-1).*(chi(:,1)-1).*(chi(:,1)-1/2);
			     4.*(chi(:,2)-1/2).*chi(:,2).*(chi(:,1)-1/2)+4.*(chi(:,2)-1/2).*chi(:,2).*(chi(:,1)-1), 4.*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-1/2)+4.*(chi(:,2)-1/2).*(chi(:,1)-1).*(chi(:,1)-1/2);
			     (-8.*(chi(:,2)-1).*(chi(:,2)-1/2).*chi(:,1))-8.*(chi(:,2)-1).*(chi(:,2)-1/2).*(chi(:,1)-1), (-8.*(chi(:,2)-1/2).*(chi(:,1)-1).*chi(:,1))-8.*(chi(:,2)-1).*(chi(:,1)-1).*chi(:,1);
			     16.*(chi(:,2)-1).*chi(:,2).*chi(:,1)+16.*(chi(:,2)-1).*chi(:,2).*(chi(:,1)-1), 16.*chi(:,2).*(chi(:,1)-1).*chi(:,1)+16.*(chi(:,2)-1).*(chi(:,1)-1).*chi(:,1);
			     (-8.*(chi(:,2)-1/2).*chi(:,2).*chi(:,1))-8.*(chi(:,2)-1/2).*chi(:,2).*(chi(:,1)-1), (-8.*chi(:,2).*(chi(:,1)-1).*chi(:,1))-8.*(chi(:,2)-1/2).*(chi(:,1)-1).*chi(:,1);
			     4.*(chi(:,2)-1).*(chi(:,2)-1/2).*chi(:,1)+4.*(chi(:,2)-1).*(chi(:,2)-1/2).*(chi(:,1)-1/2), 4.*(chi(:,2)-1/2).*(chi(:,1)-1/2).*chi(:,1)+4.*(chi(:,2)-1).*(chi(:,1)-1/2).*chi(:,1);
			     (-8.*(chi(:,2)-1).*chi(:,2).*chi(:,1))-8.*(chi(:,2)-1).*chi(:,2).*(chi(:,1)-1/2), (-8.*chi(:,2).*(chi(:,1)-1/2).*chi(:,1))-8.*(chi(:,2)-1).*(chi(:,1)-1/2).*chi(:,1);
			     4.*(chi(:,2)-1/2).*chi(:,2).*chi(:,1)+4.*(chi(:,2)-1/2).*chi(:,2).*(chi(:,1)-1/2), 4.*chi(:,2).*(chi(:,1)-1/2).*chi(:,1)+4.*(chi(:,2)-1/2).*(chi(:,1)-1/2).*chi(:,1)];
    case 3
      jacobi_matrix = @(chi) [(81.*(chi(:,2)-1).*(chi(:,2)-2/3).*(chi(:,2)-1/3).*(chi(:,1)-2/3).*(chi(:,1)-1/3))/4+(81.*(chi(:,2)-1).*(chi(:,2)-2/3).*(chi(:,2)-1/3).*(chi(:,1)-1).*(chi(:,1)-1/3))/4+(81.*(chi(:,2)-1).*(chi(:,2)-2/3).*(chi(:,2)-1/3).*(chi(:,1)-1).*(chi(:,1)-2/3))/4, (81.*(chi(:,2)-2/3).*(chi(:,2)-1/3).*(chi(:,1)-1).*(chi(:,1)-2/3).*(chi(:,1)-1/3))/4+(81.*(chi(:,2)-1).*(chi(:,2)-1/3).*(chi(:,1)-1).*(chi(:,1)-2/3).*(chi(:,1)-1/3))/4+(81.*(chi(:,2)-1).*(chi(:,2)-2/3).*(chi(:,1)-1).*(chi(:,1)-2/3).*(chi(:,1)-1/3))/4;
			      (-(243.*(chi(:,2)-1).*(chi(:,2)-2/3).*chi(:,2).*(chi(:,1)-2/3).*(chi(:,1)-1/3))/4)-(243.*(chi(:,2)-1).*(chi(:,2)-2/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-1/3))/4-(243.*(chi(:,2)-1).*(chi(:,2)-2/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-2/3))/4, (-(243.*(chi(:,2)-2/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-2/3).*(chi(:,1)-1/3))/4)-(243.*(chi(:,2)-1).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-2/3).*(chi(:,1)-1/3))/4-(243.*(chi(:,2)-1).*(chi(:,2)-2/3).*(chi(:,1)-1).*(chi(:,1)-2/3).*(chi(:,1)-1/3))/4;
			      (243.*(chi(:,2)-1).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-2/3).*(chi(:,1)-1/3))/4+(243.*(chi(:,2)-1).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-1/3))/4+(243.*(chi(:,2)-1).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-2/3))/4, (243.*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-2/3).*(chi(:,1)-1/3))/4+(243.*(chi(:,2)-1).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-2/3).*(chi(:,1)-1/3))/4+(243.*(chi(:,2)-1).*(chi(:,2)-1/3).*(chi(:,1)-1).*(chi(:,1)-2/3).*(chi(:,1)-1/3))/4;
			      (-(81.*(chi(:,2)-2/3).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-2/3).*(chi(:,1)-1/3))/4)-(81.*(chi(:,2)-2/3).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-1/3))/4-(81.*(chi(:,2)-2/3).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-2/3))/4, (-(81.*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-2/3).*(chi(:,1)-1/3))/4)-(81.*(chi(:,2)-2/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-2/3).*(chi(:,1)-1/3))/4-(81.*(chi(:,2)-2/3).*(chi(:,2)-1/3).*(chi(:,1)-1).*(chi(:,1)-2/3).*(chi(:,1)-1/3))/4;
			      (-(243.*(chi(:,2)-1).*(chi(:,2)-2/3).*(chi(:,2)-1/3).*(chi(:,1)-2/3).*chi(:,1))/4)-(243.*(chi(:,2)-1).*(chi(:,2)-2/3).*(chi(:,2)-1/3).*(chi(:,1)-1).*chi(:,1))/4-(243.*(chi(:,2)-1).*(chi(:,2)-2/3).*(chi(:,2)-1/3).*(chi(:,1)-1).*(chi(:,1)-2/3))/4, (-(243.*(chi(:,2)-2/3).*(chi(:,2)-1/3).*(chi(:,1)-1).*(chi(:,1)-2/3).*chi(:,1))/4)-(243.*(chi(:,2)-1).*(chi(:,2)-1/3).*(chi(:,1)-1).*(chi(:,1)-2/3).*chi(:,1))/4-(243.*(chi(:,2)-1).*(chi(:,2)-2/3).*(chi(:,1)-1).*(chi(:,1)-2/3).*chi(:,1))/4;
			      (729.*(chi(:,2)-1).*(chi(:,2)-2/3).*chi(:,2).*(chi(:,1)-2/3).*chi(:,1))/4+(729.*(chi(:,2)-1).*(chi(:,2)-2/3).*chi(:,2).*(chi(:,1)-1).*chi(:,1))/4+(729.*(chi(:,2)-1).*(chi(:,2)-2/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-2/3))/4, (729.*(chi(:,2)-2/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-2/3).*chi(:,1))/4+(729.*(chi(:,2)-1).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-2/3).*chi(:,1))/4+(729.*(chi(:,2)-1).*(chi(:,2)-2/3).*(chi(:,1)-1).*(chi(:,1)-2/3).*chi(:,1))/4;
			      (-(729.*(chi(:,2)-1).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-2/3).*chi(:,1))/4)-(729.*(chi(:,2)-1).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1).*chi(:,1))/4-(729.*(chi(:,2)-1).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-2/3))/4, (-(729.*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-2/3).*chi(:,1))/4)-(729.*(chi(:,2)-1).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-2/3).*chi(:,1))/4-(729.*(chi(:,2)-1).*(chi(:,2)-1/3).*(chi(:,1)-1).*(chi(:,1)-2/3).*chi(:,1))/4;
			      (243.*(chi(:,2)-2/3).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-2/3).*chi(:,1))/4+(243.*(chi(:,2)-2/3).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1).*chi(:,1))/4+(243.*(chi(:,2)-2/3).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-2/3))/4, (243.*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-2/3).*chi(:,1))/4+(243.*(chi(:,2)-2/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-2/3).*chi(:,1))/4+(243.*(chi(:,2)-2/3).*(chi(:,2)-1/3).*(chi(:,1)-1).*(chi(:,1)-2/3).*chi(:,1))/4;
			      (243.*(chi(:,2)-1).*(chi(:,2)-2/3).*(chi(:,2)-1/3).*(chi(:,1)-1/3).*chi(:,1))/4+(243.*(chi(:,2)-1).*(chi(:,2)-2/3).*(chi(:,2)-1/3).*(chi(:,1)-1).*chi(:,1))/4+(243.*(chi(:,2)-1).*(chi(:,2)-2/3).*(chi(:,2)-1/3).*(chi(:,1)-1).*(chi(:,1)-1/3))/4, (243.*(chi(:,2)-2/3).*(chi(:,2)-1/3).*(chi(:,1)-1).*(chi(:,1)-1/3).*chi(:,1))/4+(243.*(chi(:,2)-1).*(chi(:,2)-1/3).*(chi(:,1)-1).*(chi(:,1)-1/3).*chi(:,1))/4+(243.*(chi(:,2)-1).*(chi(:,2)-2/3).*(chi(:,1)-1).*(chi(:,1)-1/3).*chi(:,1))/4;
			      (-(729.*(chi(:,2)-1).*(chi(:,2)-2/3).*chi(:,2).*(chi(:,1)-1/3).*chi(:,1))/4)-(729.*(chi(:,2)-1).*(chi(:,2)-2/3).*chi(:,2).*(chi(:,1)-1).*chi(:,1))/4-(729.*(chi(:,2)-1).*(chi(:,2)-2/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-1/3))/4, (-(729.*(chi(:,2)-2/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-1/3).*chi(:,1))/4)-(729.*(chi(:,2)-1).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-1/3).*chi(:,1))/4-(729.*(chi(:,2)-1).*(chi(:,2)-2/3).*(chi(:,1)-1).*(chi(:,1)-1/3).*chi(:,1))/4;
			      (729.*(chi(:,2)-1).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1/3).*chi(:,1))/4+(729.*(chi(:,2)-1).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1).*chi(:,1))/4+(729.*(chi(:,2)-1).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-1/3))/4, (729.*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-1/3).*chi(:,1))/4+(729.*(chi(:,2)-1).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-1/3).*chi(:,1))/4+(729.*(chi(:,2)-1).*(chi(:,2)-1/3).*(chi(:,1)-1).*(chi(:,1)-1/3).*chi(:,1))/4;
			      (-(243.*(chi(:,2)-2/3).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1/3).*chi(:,1))/4)-(243.*(chi(:,2)-2/3).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1).*chi(:,1))/4-(243.*(chi(:,2)-2/3).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-1/3))/4, (-(243.*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-1/3).*chi(:,1))/4)-(243.*(chi(:,2)-2/3).*chi(:,2).*(chi(:,1)-1).*(chi(:,1)-1/3).*chi(:,1))/4-(243.*(chi(:,2)-2/3).*(chi(:,2)-1/3).*(chi(:,1)-1).*(chi(:,1)-1/3).*chi(:,1))/4;
			      (-(81.*(chi(:,2)-1).*(chi(:,2)-2/3).*(chi(:,2)-1/3).*(chi(:,1)-1/3).*chi(:,1))/4)-(81.*(chi(:,2)-1).*(chi(:,2)-2/3).*(chi(:,2)-1/3).*(chi(:,1)-2/3).*chi(:,1))/4-(81.*(chi(:,2)-1).*(chi(:,2)-2/3).*(chi(:,2)-1/3).*(chi(:,1)-2/3).*(chi(:,1)-1/3))/4, (-(81.*(chi(:,2)-2/3).*(chi(:,2)-1/3).*(chi(:,1)-2/3).*(chi(:,1)-1/3).*chi(:,1))/4)-(81.*(chi(:,2)-1).*(chi(:,2)-1/3).*(chi(:,1)-2/3).*(chi(:,1)-1/3).*chi(:,1))/4-(81.*(chi(:,2)-1).*(chi(:,2)-2/3).*(chi(:,1)-2/3).*(chi(:,1)-1/3).*chi(:,1))/4;
			      (243.*(chi(:,2)-1).*(chi(:,2)-2/3).*chi(:,2).*(chi(:,1)-1/3).*chi(:,1))/4+(243.*(chi(:,2)-1).*(chi(:,2)-2/3).*chi(:,2).*(chi(:,1)-2/3).*chi(:,1))/4+(243.*(chi(:,2)-1).*(chi(:,2)-2/3).*chi(:,2).*(chi(:,1)-2/3).*(chi(:,1)-1/3))/4, (243.*(chi(:,2)-2/3).*chi(:,2).*(chi(:,1)-2/3).*(chi(:,1)-1/3).*chi(:,1))/4+(243.*(chi(:,2)-1).*chi(:,2).*(chi(:,1)-2/3).*(chi(:,1)-1/3).*chi(:,1))/4+(243.*(chi(:,2)-1).*(chi(:,2)-2/3).*(chi(:,1)-2/3).*(chi(:,1)-1/3).*chi(:,1))/4;
			      (-(243.*(chi(:,2)-1).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1/3).*chi(:,1))/4)-(243.*(chi(:,2)-1).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-2/3).*chi(:,1))/4-(243.*(chi(:,2)-1).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-2/3).*(chi(:,1)-1/3))/4, (-(243.*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-2/3).*(chi(:,1)-1/3).*chi(:,1))/4)-(243.*(chi(:,2)-1).*chi(:,2).*(chi(:,1)-2/3).*(chi(:,1)-1/3).*chi(:,1))/4-(243.*(chi(:,2)-1).*(chi(:,2)-1/3).*(chi(:,1)-2/3).*(chi(:,1)-1/3).*chi(:,1))/4;
			      (81.*(chi(:,2)-2/3).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-1/3).*chi(:,1))/4+(81.*(chi(:,2)-2/3).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-2/3).*chi(:,1))/4+(81.*(chi(:,2)-2/3).*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-2/3).*(chi(:,1)-1/3))/4, (81.*(chi(:,2)-1/3).*chi(:,2).*(chi(:,1)-2/3).*(chi(:,1)-1/3).*chi(:,1))/4+(81.*(chi(:,2)-2/3).*chi(:,2).*(chi(:,1)-2/3).*(chi(:,1)-1/3).*chi(:,1))/4+(81.*(chi(:,2)-2/3).*(chi(:,2)-1/3).*(chi(:,1)-2/3).*(chi(:,1)-1/3).*chi(:,1))/4];
    otherwise
      error("At present, the maximum supported order is 3.");
  endswitch
endfunction
